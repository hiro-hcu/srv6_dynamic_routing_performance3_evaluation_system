# SRv6 å‹•çš„çµŒè·¯åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ  ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

> **ä½œæˆæ—¥**: 2026å¹´1æœˆ7æ—¥  
> **å¯¾è±¡**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŠã‚ˆã³è»¢é€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

---

## ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Controller (Docker Container)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    SRv6 Path Orchestrator                                â”‚    â”‚
â”‚  â”‚                                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯  â”‚  â”‚   çµŒè·¯è¨ˆç®—éƒ¨  â”‚  â”‚   çµŒè·¯æ›´æ–°éƒ¨  â”‚  â”‚  å¯è¦–åŒ–éƒ¨   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  åé›†éƒ¨      â”‚  â”‚ PathCalculatorâ”‚  â”‚RoutingTable  â”‚  â”‚ Topology    â”‚ â”‚    â”‚
â”‚  â”‚  â”‚RRDDataManagerâ”‚â†’ â”‚              â”‚â†’ â”‚   Manager    â”‚  â”‚ Visualizer  â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚         â”‚                                    â”‚                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â”‚                                    â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  RRDtool/MRTG   â”‚                  â”‚  SSH Connection â”‚                      â”‚
â”‚  â”‚  (RRDãƒ•ã‚¡ã‚¤ãƒ«)   â”‚                  â”‚     Manager     â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                        â”‚
       SNMP (UDP 161)                          SSH (TCP 22)
       ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åé›†                        çµŒè·¯è¨­å®šã‚³ãƒãƒ³ãƒ‰
                â”‚                                        â”‚
                â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Agent (Router: r1 ï½ r16)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   SNMP Agent    â”‚    â”‚                  Linux Kernel                       â”‚ â”‚
â”‚  â”‚   (snmpd)       â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚  â”‚ nftables    â”‚  â”‚ ip rule     â”‚  â”‚ SRv6 encap  â”‚ â”‚ â”‚
â”‚  â”‚ â€¢ ifHCInOctets  â”‚    â”‚  â”‚(flow labelâ†’ â”‚  â”‚(fwmarkâ†’     â”‚  â”‚(Segment     â”‚ â”‚ â”‚
â”‚  â”‚ â€¢ ifHCOutOctets â”‚    â”‚  â”‚  fwmark)    â”‚  â”‚  table)     â”‚  â”‚  Routing)   â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                         â”‚                                                      â”‚ â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚                         â”‚  â”‚           ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«                   â”‚ â”‚ â”‚
â”‚                         â”‚  â”‚  rt_table1 (é«˜å„ªå…ˆåº¦: mark 4)                   â”‚ â”‚ â”‚
â”‚                         â”‚  â”‚  rt_table2 (ä¸­å„ªå…ˆåº¦: mark 6)                   â”‚ â”‚ â”‚
â”‚                         â”‚  â”‚  rt_table3 (ä½å„ªå…ˆåº¦: mark 9)                   â”‚ â”‚ â”‚
â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ç”¨èªå®šç¾©

### Controllerå´ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | èª¬æ˜ | å®Ÿè£… |
|---------------|------|------|
| **MRTG** | Multi Router Traffic Grapherã€‚SNMPã§åé›†ã—ãŸãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’å®šæœŸåé›† | `mrtg_kurage.conf` |
| **RRD** | Round Robin Databaseã€‚æ™‚ç³»åˆ—ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®æ ¼ç´ | `mrtg_file/*.rrd` |
| **ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åé›†éƒ¨** | RRDãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¨ãƒƒã‚¸åˆ©ç”¨ç‡ã‚’å–å¾—ã—ã€ã‚°ãƒ©ãƒ•ã®é‡ã¿ã‚’æ›´æ–° | `RRDDataManager` ã‚¯ãƒ©ã‚¹ |
| **çµŒè·¯è¨ˆç®—éƒ¨** | Dijkstraæ³•ã«åŸºã¥ãè¤‡æ•°çµŒè·¯è¨ˆç®—ã€SIDãƒªã‚¹ãƒˆç”Ÿæˆ | `PathCalculator` ã‚¯ãƒ©ã‚¹ |
| **çµŒè·¯æ›´æ–°éƒ¨** | SSHçµŒç”±ã§ãƒ«ãƒ¼ã‚¿ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‹•çš„æ›´æ–° | `RoutingTableManager` + `SSHConnectionManager` |

### Agentå´ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | èª¬æ˜ | å®Ÿè£… |
|---------------|------|------|
| **SNMP Agent** | Net-SNMP ãƒ‡ãƒ¼ãƒ¢ãƒ³ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯çµ±è¨ˆã‚’æä¾› | `snmpd.conf` |
| **Linux Kernel** | ãƒ‘ã‚±ãƒƒãƒˆè»¢é€ã€nftablesã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€SRv6å‡¦ç†ã‚’æ‹…å½“ | ã‚«ãƒ¼ãƒãƒ« + iproute2 |
| **nftables** | IPv6ãƒ•ãƒ­ãƒ¼ãƒ©ãƒ™ãƒ«ã‚’fwmarkã«å¤‰æ›ï¼ˆQoSåˆ†é¡ï¼‰ | `r1_phase2_nftables_setup.py` |
| **ip rule** | fwmarkã«åŸºã¥ã„ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é¸æŠ | `r1_phase1_table_setup.py` |
| **SRv6 encap** | Segment Routing over IPv6ã«ã‚ˆã‚‹ãƒ‘ã‚±ãƒƒãƒˆã‚«ãƒ—ã‚»ãƒ«åŒ– | Linux Kernel seg6 module |

---

## ğŸ”„ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ 1: å…¨ä½“ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    autonumber
    participant Admin as ç®¡ç†è€…
    participant DC as docker-compose
    participant Ctrl as Controller
    participant R1 as Router r1
    participant Rn as Routers r2-r15
    participant R16 as Router r16

    Note over Admin,R16: === ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ãƒ•ã‚§ãƒ¼ã‚º ===
    
    Admin->>DC: docker-compose up -d
    DC->>Ctrl: Controller ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
    DC->>R1: r1 ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
    DC->>Rn: r2-r15 ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
    DC->>R16: r16 ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
    
    par å„ãƒ«ãƒ¼ã‚¿ã®åˆæœŸåŒ–
        R1->>R1: srv6_setup.sh å®Ÿè¡Œ
        R1->>R1: SRv6æœ‰åŠ¹åŒ– (sysctl)
        R1->>R1: snmpd èµ·å‹•
        R1->>R1: sshd èµ·å‹•
        R1->>R1: å¸¯åŸŸåˆ¶é™è¨­å®š (tc)
    and
        Rn->>Rn: srv6_setup.sh å®Ÿè¡Œ
        Rn->>Rn: snmpd èµ·å‹•
    and
        R16->>R16: srv6_setup.sh å®Ÿè¡Œ
        R16->>R16: snmpd èµ·å‹•
        R16->>R16: sshd èµ·å‹•
    end
    
    Note over Admin,R16: === Phase 1: ãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ===
    
    Admin->>Ctrl: r1_phase1_table_setup.py å®Ÿè¡Œ
    Ctrl->>R1: SSHæ¥ç¶š
    Ctrl->>R1: rt_table1/2/3 ä½œæˆ
    Ctrl->>R1: ip -6 rule add (fwmarkâ†’table)
    R1-->>Ctrl: è¨­å®šå®Œäº†
    
    Admin->>Ctrl: r16_phase1_table_setup.py å®Ÿè¡Œ
    Ctrl->>R16: SSHæ¥ç¶š
    Ctrl->>R16: rt_table_1/2/3 ä½œæˆ (å¾©è·¯ç”¨)
    Ctrl->>R16: ip -6 rule add
    R16-->>Ctrl: è¨­å®šå®Œäº†
    
    Note over Admin,R16: === Phase 2: nftablesã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ===
    
    Admin->>Ctrl: r1_phase2_nftables_setup.py å®Ÿè¡Œ
    Ctrl->>R1: SSHæ¥ç¶š
    Ctrl->>R1: nft add table ip6 mangle
    Ctrl->>R1: nft add chain prerouting
    Ctrl->>R1: nft add rule (flowlabel 0xfffc4â†’mark 4)
    Ctrl->>R1: nft add rule (flowlabel 0xfffc6â†’mark 6)
    Ctrl->>R1: nft add rule (defaultâ†’mark 9)
    R1-->>Ctrl: è¨­å®šå®Œäº†
    
    Note over Admin,R16: === MRTG/RRD åˆæœŸåŒ– ===
    
    loop MRTGå®šæœŸåé›† (1åˆ†é–“éš”)
        Ctrl->>R1: SNMP GET (ifHCInOctets, ifHCOutOctets)
        R1-->>Ctrl: ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯çµ±è¨ˆ
        Ctrl->>Rn: SNMP GET
        Rn-->>Ctrl: ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯çµ±è¨ˆ
        Ctrl->>R16: SNMP GET
        R16-->>Ctrl: ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯çµ±è¨ˆ
        Ctrl->>Ctrl: RRDãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°
    end
```

---

## ğŸ”„ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ 2: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµŒè·¯åˆ¶å¾¡ã‚µã‚¤ã‚¯ãƒ« (Phase 3)

```mermaid
sequenceDiagram
    autonumber
    participant Main as SRv6PathManager
    participant RRD as RRDDataManager<br/>(ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åé›†éƒ¨)
    participant PC as PathCalculator<br/>(çµŒè·¯è¨ˆç®—éƒ¨)
    participant RTM as RoutingTableManager<br/>(çµŒè·¯æ›´æ–°éƒ¨)
    participant SSH as SSHConnectionManager
    participant R1 as Router r1<br/>(Linux Kernel)
    participant R16 as Router r16<br/>(Linux Kernel)
    participant Vis as TopologyVisualizer

    Note over Main,Vis: === 1åˆ†ã”ã¨ã®çµŒè·¯æ›´æ–°ã‚µã‚¤ã‚¯ãƒ« ===
    
    loop æ¯åˆ†å®Ÿè¡Œ (MEASUREMENT_DURATION_MINUTES ã¾ã§)
        Main->>RRD: update_edge_weights(graph)
        
        Note over RRD: ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åé›†ãƒ•ã‚§ãƒ¼ã‚º
        loop å…¨24ã‚¨ãƒƒã‚¸ã«å¯¾ã—ã¦
            RRD->>RRD: fetch_rrd_data(rrd_path)
            RRD->>RRD: rrdtool fetch AVERAGE --start -60s
            RRD->>RRD: åˆ©ç”¨ç‡è¨ˆç®— (out_bytes / max_bandwidth)
            RRD->>PC: graph[u][v]['weight'] = åˆ©ç”¨ç‡
        end
        RRD-->>Main: é‡ã¿æ›´æ–°å®Œäº†
        
        Note over Main,PC: çµŒè·¯è¨ˆç®—ãƒ•ã‚§ãƒ¼ã‚º
        Main->>PC: calculate_multiple_paths(src=1, dst=16, n=3)
        
        PC->>PC: Dijkstraæ³•ã§æœ€çŸ­çµŒè·¯1 (é«˜å„ªå…ˆåº¦)
        PC->>PC: ä½¿ç”¨ã‚¨ãƒƒã‚¸ã®é‡ã¿ Ã—3.0
        PC->>PC: Dijkstraæ³•ã§æœ€çŸ­çµŒè·¯2 (ä¸­å„ªå…ˆåº¦)
        PC->>PC: ä½¿ç”¨ã‚¨ãƒƒã‚¸ã®é‡ã¿ Ã—2.0
        PC->>PC: Dijkstraæ³•ã§æœ€çŸ­çµŒè·¯3 (ä½å„ªå…ˆåº¦)
        
        PC-->>Main: [(path1, cost1), (path2, cost2), (path3, cost3)]
        
        Note over Main,RTM: çµŒè·¯è¨­å®šãƒ•ã‚§ãƒ¼ã‚º (å¾€è·¯: r1)
        Main->>RTM: create_table_routes(forward_path)
        RTM->>PC: path_to_sid_list(path, is_return=False)
        PC-->>RTM: [SID1, SID2, ...], interface
        RTM-->>Main: [TableRoute1, TableRoute2, TableRoute3]
        
        Main->>RTM: update_all_tables(forward_routes)
        RTM->>SSH: r1_connection()
        SSH->>R1: SSHæ¥ç¶š (fd02:1::2)
        
        loop å„ãƒ†ãƒ¼ãƒ–ãƒ« (rt_table1/2/3)
            RTM->>SSH: execute_command(clear_route)
            SSH->>R1: ip -6 route del ... table rt_tableX
            R1-->>SSH: OK
            
            RTM->>SSH: execute_command(add_route)
            SSH->>R1: ip -6 route add fd03:1::/64 encap seg6 mode encap segs SID1,SID2,... dev ethX table rt_tableX
            R1->>R1: ã‚«ãƒ¼ãƒãƒ«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
            R1-->>SSH: OK
        end
        SSH-->>RTM: æ›´æ–°å®Œäº†
        RTM-->>Main: å¾€è·¯æ›´æ–°æˆåŠŸ
        
        Note over Main,RTM: çµŒè·¯è¨­å®šãƒ•ã‚§ãƒ¼ã‚º (å¾©è·¯: r16)
        Main->>RTM: create_return_table_routes(reverse_path)
        RTM->>PC: path_to_sid_list(path, is_return=True)
        PC-->>RTM: [SID1, SID2, ...], interface
        
        Main->>RTM: update_return_tables(return_routes)
        RTM->>SSH: r16_connection()
        SSH->>R16: SSHæ¥ç¶š (fd02:1::11)
        
        loop å„ãƒ†ãƒ¼ãƒ–ãƒ« (rt_table_1/2/3)
            RTM->>SSH: execute_command(add_route)
            SSH->>R16: ip -6 route add fd00:1::/64 encap seg6 mode encap segs ... table rt_table_X
            R16->>R16: ã‚«ãƒ¼ãƒãƒ«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
            R16-->>SSH: OK
        end
        RTM-->>Main: å¾©è·¯æ›´æ–°æˆåŠŸ
        
        Note over Main,Vis: å¯è¦–åŒ–ãƒ•ã‚§ãƒ¼ã‚º
        Main->>Vis: visualize(paths, update_count)
        Vis->>Vis: ãƒˆãƒãƒ­ã‚¸æç”» + çµŒè·¯ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        Vis->>Vis: ç”»åƒä¿å­˜ (topology_latest.png)
        Vis->>Vis: å±¥æ­´ä¿å­˜ (N_minutes.png)
        Vis-->>Main: å¯è¦–åŒ–å®Œäº†
        
        Main->>Main: sleep(60ç§’)
    end
```

---

## ğŸ”„ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ 3: ãƒ‘ã‚±ãƒƒãƒˆè»¢é€ãƒ•ãƒ­ãƒ¼ï¼ˆAgentå†…éƒ¨å‡¦ç†ï¼‰

```mermaid
sequenceDiagram
    autonumber
    participant UPF as UPF<br/>(5G Core)
    participant R1_NIC as r1 NIC<br/>(eth0)
    participant NFT as nftables<br/>(ip6 mangle)
    participant RULE as ip rule<br/>(fwmark lookup)
    participant RT as ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°<br/>ãƒ†ãƒ¼ãƒ–ãƒ«
    participant SRV6 as SRv6 encap<br/>(seg6 module)
    participant R1_OUT as r1 NIC<br/>(eth1/eth2)
    participant RN as ä¸­é–“ãƒ«ãƒ¼ã‚¿<br/>(r2-r15)
    participant R16 as Router r16
    participant Server as Server

    Note over UPF,Server: === ãƒ‘ã‚±ãƒƒãƒˆå—ä¿¡ã¨åˆ†é¡ ===
    
    UPF->>R1_NIC: IPv6ãƒ‘ã‚±ãƒƒãƒˆåˆ°ç€<br/>(Flow Label: 0xfffc4)
    R1_NIC->>NFT: ãƒ‘ã‚±ãƒƒãƒˆã‚’nftables prerouting chainã¸
    
    alt Flow Label = 0xfffc4 (é«˜å„ªå…ˆåº¦)
        NFT->>NFT: meta mark set 4
        NFT-->>RULE: ãƒ‘ã‚±ãƒƒãƒˆ (mark=4)
    else Flow Label = 0xfffc6 (ä¸­å„ªå…ˆåº¦)
        NFT->>NFT: meta mark set 6
        NFT-->>RULE: ãƒ‘ã‚±ãƒƒãƒˆ (mark=6)
    else ãã®ä»– (ä½å„ªå…ˆåº¦/ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
        NFT->>NFT: meta mark set 9
        NFT-->>RULE: ãƒ‘ã‚±ãƒƒãƒˆ (mark=9)
    end
    
    Note over RULE,RT: === ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«é¸æŠ ===
    
    alt mark = 4
        RULE->>RT: lookup rt_table1
        RT-->>RULE: fd03:1::/64 encap seg6 segs [æœ€é©çµŒè·¯SID]
    else mark = 6
        RULE->>RT: lookup rt_table2
        RT-->>RULE: fd03:1::/64 encap seg6 segs [ä»£æ›¿çµŒè·¯SID]
    else mark = 9
        RULE->>RT: lookup rt_table3
        RT-->>RULE: fd03:1::/64 encap seg6 segs [æ¨™æº–çµŒè·¯SID]
    end
    
    Note over SRV6,R16: === SRv6ã‚«ãƒ—ã‚»ãƒ«åŒ–ã¨è»¢é€ ===
    
    RULE->>SRV6: SRv6 encapsulation è¦æ±‚
    SRV6->>SRV6: å¤–å´IPv6ãƒ˜ãƒƒãƒ€è¿½åŠ 
    SRV6->>SRV6: Segment Routing Header (SRH) æŒ¿å…¥
    SRV6->>SRV6: Segments Left = N-1
    SRV6->>R1_OUT: ã‚«ãƒ—ã‚»ãƒ«åŒ–ãƒ‘ã‚±ãƒƒãƒˆé€å‡º
    
    R1_OUT->>RN: SRv6ãƒ‘ã‚±ãƒƒãƒˆè»¢é€<br/>(å®›å…ˆ: SID[0])
    
    loop å„ä¸­é–“ãƒãƒ¼ãƒ‰ (SIDãƒªã‚¹ãƒˆé †)
        RN->>RN: SRHå‡¦ç†<br/>Segments Left--
        RN->>RN: æ¬¡ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¸è»¢é€
    end
    
    RN->>R16: æœ€çµ‚ãƒ›ãƒƒãƒ—è»¢é€
    R16->>R16: SRHå‡¦ç† (Segments Left = 0)
    R16->>R16: Decapsulation (End.DX6)
    R16->>Server: å…ƒã®IPv6ãƒ‘ã‚±ãƒƒãƒˆé…é€
    
    Note over UPF,Server: === ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (å¾©è·¯) ===
    
    Server->>R16: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‘ã‚±ãƒƒãƒˆ
    R16->>R16: nftables + ip rule (å¾©è·¯ç”¨)
    R16->>R16: SRv6 encap (å¾©è·¯çµŒè·¯)
    R16->>RN: SRv6ãƒ‘ã‚±ãƒƒãƒˆè»¢é€
    RN->>R1_NIC: æœ€çµ‚ãƒ›ãƒƒãƒ—
    R1_NIC->>UPF: Decapsulated ãƒ‘ã‚±ãƒƒãƒˆ
```

---

## ğŸ”„ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ 4: ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åé›†è©³ç´°ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    autonumber
    participant MRTG as MRTG<br/>(cron job)
    participant SNMP_C as SNMP Client<br/>(net-snmp)
    participant SNMPD as snmpd<br/>(Router)
    participant KERNEL as Linux Kernel<br/>(Router)
    participant RRD_F as RRDãƒ•ã‚¡ã‚¤ãƒ«
    participant RRD_M as RRDDataManager
    participant GRAPH as NetworkX Graph

    Note over MRTG,GRAPH: === MRTG ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åé›† (1åˆ†é–“éš”) ===
    
    loop å„ãƒ«ãƒ¼ã‚¿ (r1-r16)
        MRTG->>SNMP_C: SNMPãƒªã‚¯ã‚¨ã‚¹ãƒˆç”Ÿæˆ
        SNMP_C->>SNMPD: SNMP GET Request<br/>OID: ifHCInOctets, ifHCOutOctets
        SNMPD->>KERNEL: /proc/net/dev èª­ã¿å–ã‚Š
        KERNEL-->>SNMPD: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµ±è¨ˆ
        SNMPD-->>SNMP_C: SNMP Response<br/>(64-bit counters)
        SNMP_C-->>MRTG: ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯å€¤
    end
    
    MRTG->>RRD_F: rrdtool update<br/>å„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®in/outå€¤
    RRD_F->>RRD_F: Round Robin ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ›´æ–°
    
    Note over RRD_M,GRAPH: === çµŒè·¯è¨ˆç®—ç”¨ãƒ‡ãƒ¼ã‚¿å–å¾— ===
    
    RRD_M->>RRD_F: rrdtool fetch AVERAGE --start -60s
    RRD_F-->>RRD_M: timestamp: ds0(in) ds1(out)
    
    RRD_M->>RRD_M: å‡ºåŠ›ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯(ds1)ã‚’æŠ½å‡º
    RRD_M->>RRD_M: åˆ©ç”¨ç‡è¨ˆç®—<br/>utilization = out_bytes / max_bandwidth
    RRD_M->>RRD_M: ç¯„å›²ã‚¯ãƒªãƒƒãƒ—: max(0.0, min(1.0, u))
    RRD_M->>RRD_M: æœ€å°é‡ã¿ä¿è¨¼: max(utilization, 0.0001)
    
    RRD_M->>GRAPH: graph[u][v]['weight'] = åˆ©ç”¨ç‡
    
    Note over GRAPH: 24ã‚¨ãƒƒã‚¸ã™ã¹ã¦ã®é‡ã¿ãŒæ›´æ–°ã•ã‚Œã‚‹<br/>åˆ©ç”¨ç‡: 0.0001 ï½ 1.0
```

---

## ğŸ“ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–¢ä¿‚å›³

```mermaid
graph TB
    subgraph Controller["Controller (Docker Container)"]
        subgraph Orchestrator["SRv6 Path Orchestrator"]
            PM[SRv6PathManager<br/>ãƒ¡ã‚¤ãƒ³åˆ¶å¾¡]
            RDM[RRDDataManager<br/>ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åé›†éƒ¨]
            PC[PathCalculator<br/>çµŒè·¯è¨ˆç®—éƒ¨]
            RTM[RoutingTableManager<br/>çµŒè·¯æ›´æ–°éƒ¨]
            SSH[SSHConnectionManager]
            TV[TopologyVisualizer<br/>å¯è¦–åŒ–éƒ¨]
        end
        
        subgraph DataStore["ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢"]
            MRTG[MRTG<br/>ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åé›†]
            RRD[(RRDãƒ•ã‚¡ã‚¤ãƒ«<br/>æ™‚ç³»åˆ—DB)]
        end
        
        PM --> RDM
        PM --> PC
        PM --> RTM
        PM --> TV
        RTM --> SSH
        RDM --> RRD
        MRTG --> RRD
    end
    
    subgraph Agent["Agent (Router r1/r16)"]
        subgraph SNMP["ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯æä¾›"]
            SNMPD[SNMP Agent<br/>snmpd]
        end
        
        subgraph Kernel["Linux Kernel"]
            NFT[nftables<br/>FlowLabelâ†’fwmark]
            IPRULE[ip rule<br/>fwmarkâ†’table]
            RTTBL[(ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°<br/>ãƒ†ãƒ¼ãƒ–ãƒ«)]
            SRV6[SRv6 encap<br/>Segment Routing]
        end
        
        NFT --> IPRULE
        IPRULE --> RTTBL
        RTTBL --> SRV6
    end
    
    MRTG -.->|SNMP GET| SNMPD
    SSH -.->|SSH/ip route| RTTBL
    
    style Controller fill:#e1f5fe
    style Agent fill:#fff3e0
    style Orchestrator fill:#bbdefb
    style DataStore fill:#c8e6c9
    style Kernel fill:#ffe0b2
```

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ¦‚è¦

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚         Controller              â”‚
                                    â”‚                                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   MRTG    â”‚â”€â”€SNMP GETâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    RRD (æ™‚ç³»åˆ—DB)       â”‚   â”‚
    â”‚ (å®šæœŸåé›†) â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚              â”‚                  â”‚
                                    â”‚              â–¼                  â”‚
                                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                    â”‚  â”‚ ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åé›†éƒ¨       â”‚   â”‚
                                    â”‚  â”‚ (RRDDataManager)        â”‚   â”‚
                                    â”‚  â”‚ - rrdtool fetch         â”‚   â”‚
                                    â”‚  â”‚ - åˆ©ç”¨ç‡è¨ˆç®—            â”‚   â”‚
                                    â”‚  â”‚ - ã‚¨ãƒƒã‚¸é‡ã¿æ›´æ–°        â”‚   â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                    â”‚              â”‚                  â”‚
                                    â”‚              â–¼                  â”‚
                                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                    â”‚  â”‚ çµŒè·¯è¨ˆç®—éƒ¨               â”‚   â”‚
                                    â”‚  â”‚ (PathCalculator)        â”‚   â”‚
                                    â”‚  â”‚ - Dijkstraæ³•            â”‚   â”‚
                                    â”‚  â”‚ - 3çµŒè·¯é¸æŠ             â”‚   â”‚
                                    â”‚  â”‚ - SIDãƒªã‚¹ãƒˆç”Ÿæˆ         â”‚   â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                    â”‚              â”‚                  â”‚
                                    â”‚              â–¼                  â”‚
                                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                    â”‚  â”‚ çµŒè·¯æ›´æ–°éƒ¨               â”‚   â”‚
                                    â”‚  â”‚ (RoutingTableManager)   â”‚   â”‚
                                    â”‚  â”‚ - SSHæ¥ç¶š               â”‚   â”‚
                                    â”‚  â”‚ - ip route ã‚³ãƒãƒ³ãƒ‰     â”‚   â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                    â”‚              â”‚                  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                        SSH (ip -6 route add)
                                                   â”‚
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Agent (Router r1/r16)                              â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   snmpd    â”‚    â”‚   nftables   â”‚    â”‚   ip rule    â”‚    â”‚   SRv6      â”‚ â”‚
â”‚  â”‚            â”‚    â”‚              â”‚    â”‚              â”‚    â”‚   encap     â”‚ â”‚
â”‚  â”‚ ifHC*Octetsâ”‚    â”‚ FlowLabel    â”‚â”€â”€â”€â–¶â”‚ fwmark       â”‚â”€â”€â”€â–¶â”‚ Segment     â”‚ â”‚
â”‚  â”‚            â”‚    â”‚    â†“         â”‚    â”‚    â†“         â”‚    â”‚ Routing     â”‚ â”‚
â”‚  â”‚  çµ±è¨ˆæä¾›  â”‚    â”‚ fwmark       â”‚    â”‚ tableé¸æŠ    â”‚    â”‚ Header      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚        â–²                                                          â”‚         â”‚
â”‚        â”‚                                                          â–¼         â”‚
â”‚   SNMP GET                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   (MRTG)                                                 â”‚ ãƒ‘ã‚±ãƒƒãƒˆè»¢é€ â”‚    â”‚
â”‚                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å‡¦ç†ãƒ•ãƒ­ãƒ¼è¦ç´„

### 1. ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åé›† (MRTG â†’ RRD)
1. MRTG ãŒ1åˆ†é–“éš”ã§å…¨ãƒ«ãƒ¼ã‚¿ã« SNMP GET ã‚’ç™ºè¡Œ
2. å„ãƒ«ãƒ¼ã‚¿ã® snmpd ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµ±è¨ˆï¼ˆifHCInOctets/ifHCOutOctetsï¼‰ã‚’è¿”å´
3. MRTG ãŒ RRD ãƒ•ã‚¡ã‚¤ãƒ«ã«æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿å­˜

### 2. çµŒè·¯è¨ˆç®— (Controller)
1. RRDDataManager ãŒ rrdtool fetch ã§æœ€æ–°ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯å€¤ã‚’å–å¾—
2. åˆ©ç”¨ç‡ = è»¢é€é‡ / æœ€å¤§å¸¯åŸŸå¹… ã‚’è¨ˆç®—ã—ã€ã‚°ãƒ©ãƒ•ã®ã‚¨ãƒƒã‚¸é‡ã¿ã‚’æ›´æ–°
3. PathCalculator ãŒ Dijkstra æ³•ã§3ã¤ã®ç•°ãªã‚‹çµŒè·¯ã‚’è¨ˆç®—
4. å„çµŒè·¯ã‚’ SRv6 SID ãƒªã‚¹ãƒˆã«å¤‰æ›

### 3. çµŒè·¯æ›´æ–° (Controller â†’ Agent)
1. SSHConnectionManager ã§ r1/r16 ã«æ¥ç¶š
2. RoutingTableManager ãŒ ip -6 route ã‚³ãƒãƒ³ãƒ‰ã§çµŒè·¯ã‚’æ›´æ–°
3. å„å„ªå…ˆåº¦ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆrt_table1/2/3ï¼‰ã« SRv6 encap çµŒè·¯ã‚’è¨­å®š

### 4. ãƒ‘ã‚±ãƒƒãƒˆè»¢é€ (Agent)
1. ãƒ‘ã‚±ãƒƒãƒˆå—ä¿¡æ™‚ã€nftables ãŒ FlowLabel ã‚’ fwmark ã«å¤‰æ›
2. ip rule ãŒ fwmark ã«åŸºã¥ã„ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é¸æŠ
3. é¸æŠã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«ã® SRv6 çµŒè·¯ã«å¾“ã„ãƒ‘ã‚±ãƒƒãƒˆã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–
4. Segment Routing Header ã«å¾“ã£ã¦ä¸­é–“ãƒãƒ¼ãƒ‰ã‚’çµŒç”±
5. çµ‚ç«¯ãƒãƒ¼ãƒ‰ã§ãƒ‡ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ã¦å®›å…ˆã«é…é€
